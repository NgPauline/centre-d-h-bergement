<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/header :: head">
    <title>Gestion des Contrats - Centre d'H√©bergement</title>
    <link rel="stylesheet" th:href="@{/css/base/style.css}">
</head>
<body>
    <div th:replace="fragments/header :: header"></div>

    <main class="main-content">
        <div class="page-header">
            <h1 class="page-title">Gestion des Contrats</h1>
            <button class="btn btn-primary" onclick="openCreateModal()">
                <i>üìù</i> Nouveau Contrat
            </button>
        </div>

        <!-- Alertes contrats -->
        <div id="contractAlerts" class="alerts-container">
            <!-- Alertes dynamiques -->
        </div>

        <!-- Statistiques -->
        <div class="stats-grid">
            <div class="stat-card success" onclick="filterByStatus('actifs')">
                <div class="stat-number" id="activeCount">0</div>
                <div class="stat-label">Actifs</div>
            </div>
            <div class="stat-card warning" onclick="filterByStatus('expirant-soon')">
                <div class="stat-number" id="expiringCount">0</div>
                <div class="stat-label">Expirent bient√¥t</div>
            </div>
            <div class="stat-card danger" onclick="filterByStatus('expires')">
                <div class="stat-number" id="expiredCount">0</div>
                <div class="stat-label">Expir√©s</div>
            </div>
        </div>

        <!-- Filtres -->
        <div class="filters-card">
            <div class="filter-group">
                <label>Statut:</label>
                <select id="statusFilter" onchange="loadContrats()">
                    <option value="all">Tous les contrats</option>
                    <option value="actifs">Actifs</option>
                    <option value="expirant-soon">Expirent bient√¥t</option>
                    <option value="expires">Expir√©s</option>
                </select>
            </div>
            <div class="filter-group">
                <label>Type h√©bergement:</label>
                <select id="typeFilter" onchange="loadContrats()">
                    <option value="">Tous les types</option>
                    <option value="PERMANENT">Permanent</option>
                    <option value="TEMPORAIRE">Temporaire</option>
                    <option value="JOURNEE">Journ√©e</option>
                </select>
            </div>
        </div>

        <!-- Liste des contrats -->
        <div class="card">
            <div class="card-header">
                <h3>Contrats d'H√©bergement</h3>
                <div class="header-actions">
                    <span id="contractCount" class="badge">0 contrats</span>
                </div>
            </div>
            <div class="card-body">
                <table class="table">
                    <thead>
                        <tr>
                            <th>R√©sident</th>
                            <th>Type</th>
                            <th>Date d√©but</th>
                            <th>Date fin</th>
                            <th>Tarif mensuel</th>
                            <th>Statut</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="contratsTableBody">
                        <!-- Charg√© dynamiquement -->
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <!-- Modal Contrat -->
    <div id="contratModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h3 id="modalTitle">Nouveau Contrat</h3>
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="contratForm" onsubmit="submitContratForm(event)">
                    <input type="hidden" id="contratId">
                    
                    <div class="form-group">
                        <label for="residentId">R√©sident *</label>
                        <select id="residentId" required>
                            <option value="">S√©lectionnez un r√©sident</option>
                        </select>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="dateDebut">Date de d√©but *</label>
                            <input type="date" id="dateDebut" required>
                        </div>
                        <div class="form-group">
                            <label for="dateFin">Date de fin *</label>
                            <input type="date" id="dateFin" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="typeHebergement">Type d'h√©bergement *</label>
                            <select id="typeHebergement" required>
                                <option value="">S√©lectionnez</option>
                                <option value="PERMANENT">H√©bergement permanent</option>
                                <option value="TEMPORAIRE">H√©bergement temporaire</option>
                                <option value="JOURNEE">Accueil de jour</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="dureeContrat">Dur√©e du contrat</label>
                            <input type="text" id="dureeContrat" placeholder="Ex: 1 an">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="tarifMensuel">Tarif mensuel (‚Ç¨) *</label>
                        <input type="number" id="tarifMensuel" min="0" step="0.01" required>
                    </div>

                    <div class="form-group">
                        <label for="conditions">Conditions g√©n√©rales</label>
                        <textarea id="conditions" rows="3" placeholder="Conditions sp√©cifiques du contrat..."></textarea>
                    </div>

                    <div class="form-group">
                        <label for="conditionsParticulieres">Conditions particuli√®res</label>
                        <textarea id="conditionsParticulieres" rows="2" placeholder="Conditions sp√©cifiques au r√©sident..."></textarea>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-outline" onclick="closeModal()">Annuler</button>
                        <button type="submit" class="btn btn-primary">Enregistrer le contrat</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Renouvellement -->
    <div id="renewModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Renouveler le Contrat</h3>
                <span class="close" onclick="closeRenewModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="contract-info">
                    <h4 id="renewResident"></h4>
                    <p><strong>Contrat actuel jusqu'au:</strong> <span id="currentEndDate"></span></p>
                    <p><strong>Tarif actuel:</strong> <span id="currentTarif"></span> ‚Ç¨/mois</p>
                </div>

                <form onsubmit="renewContract(event)">
                    <input type="hidden" id="renewContractId">
                    
                    <div class="form-group">
                        <label for="nouvelleDateFin">Nouvelle date de fin *</label>
                        <input type="date" id="nouvelleDateFin" required>
                    </div>

                    <div class="form-group">
                        <label for="nouveauTarif">Nouveau tarif mensuel (‚Ç¨)</label>
                        <input type="number" id="nouveauTarif" min="0" step="0.01" placeholder="Laissez vide pour garder le m√™me">
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-outline" onclick="closeRenewModal()">Annuler</button>
                        <button type="submit" class="btn btn-primary">Renouveler le contrat</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal R√©siliation -->
    <div id="cancelModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>R√©silier le Contrat</h3>
                <span class="close" onclick="closeCancelModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="alert alert-warning">
                    <strong>Attention:</strong> Cette action est irr√©versible. Le contrat sera marqu√© comme r√©sili√©.
                </div>

                <form onsubmit="cancelContract(event)">
                    <input type="hidden" id="cancelContractId">
                    
                    <div class="form-group">
                        <label for="motifResiliation">Motif de r√©siliation *</label>
                        <textarea id="motifResiliation" rows="3" required placeholder="Raison de la r√©siliation..."></textarea>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-outline" onclick="closeCancelModal()">Annuler</button>
                        <button type="submit" class="btn btn-danger">Confirmer la r√©siliation</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div th:replace="fragments/footer :: footer"></div>
    <script th:src="@{/js/app.js}"></script>
</body>
</html>